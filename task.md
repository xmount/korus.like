Тестовое задание

Общая часть.
На сайте один пользователь может сказать спасибо другому пользователю. Необходимо написать компонент, отображающий следующий отчет со следующей информацией:
- кто больше всех говорит спасибо
- кому больше всех говорят спасибо

Сущности системы и их свойства. Сущности системы создать и описать самостоятельно. Классы описывающие сущности должны присутствовать в репозитории.

User
* id (int) - Идентификатор пользователя
* name (string) - Имя пользователя

Thank
* id (int) - Идентификатор благодарности
* user_from_id (int) - Кто поблагодарил. Ссылка на сущность User
* user_to_id (int) - Кого поблагодарили. Ссылка на сущность User
* date (datetime) - Дата благодарности

Department
* id (int) - Идентификатор подразделения
* name (int) - Название подразделения
* parent (int) - Идентификатор родительского подразделения

User_Department
* id (int) - Идентификатор связи
* user_id (int) - Идентификатор пользователя
* department_id (int) - Идентификатор подразделения

Отчет можно фильтровать по следующим полям:
Дата благодарности: интервал от и до
Департамент пользователя: выбор из списка всех департаментов
Кто сказал спасибо: Имя пользователь, который благодарил
Кому сказали спасибо: Имя пользователь, которого благодарили
Список отсортирован по количеству благодарностей от большего к меньшему
В списке есть постраничный указатель. На страницу выводится 20 записей

Пример того, как должен выглядеть отчет:

Пользователь 		Количество благодарностей
Иванов Иван 		100
Петров Петр 		90
Сидоров Сидор 		80
....
Яковлев Яков 		1

Важно: пользователей 5000. Всего благодарностей в базе 70000.

Количество запросов к базе должно быть минимально.
Все группировки должны быть сделаны на уровне БД. Группировать на фронте нельзя, потому что элементов очень много.
Можно использовать битрикс как фреймворк. Или можно сделать без битрикса, но в этом случае можно использовать только готовые компоненты (не фреймворки), например ORM, подключая их через Composer.

Решение выложить в публичный репозиторий на github или bitbucket и прислать ссылку.
Код оформить в соответствие с требованиями PSR-2.
В коде должны присутствовать комментарии, разъясняющие реализацию.
